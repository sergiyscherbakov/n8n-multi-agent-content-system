# Multi-Agent System для створення контенту в n8n

## Опис

Цей проект містить готовий workflow для створення мульти-агентної системи, яка автоматично класифікує теми та генерує контент з використанням штучного інтелекту.

## Що робить система

Шаблон промпту для контент-агента дозволяє:
- класифікувати теми як "ШІ" (пов'язані зі штучним інтелектом) або "неШІ"
- автоматично обирати відповідний агент для обробки запиту
- генерувати структурований контент відповідно до типу теми
- надавати рекомендації з впровадження ШІ для різних бізнес-кейсів
- створювати детальні статті про технології штучного інтелекту

## Архітектура Multi-Agent System

Система складається з трьох спеціалізованих AI агентів:

```
When chat message received
          ↓
    AI Orkestrator (Головний координатор)
          ↓
    ┌─────┴─────┐
    ↓           ↓
Other_topic   AI_topic
(неШІ теми)  (ШІ теми)
```

### Потік роботи:

1. **Користувач надає тему** → Chat Trigger
2. **AI Orkestrator класифікує** → "ШІ" або "неШІ"
3. **Якщо "неШІ"**:
   - Other_topic генерує 3 кейси впровадження ШІ
   - Результат передається в AI_topic
   - AI_topic створює детальну статтю про ШІ
4. **Якщо "ШІ"**:
   - AI_topic одразу створює детальну статтю
5. **Результат** → Структурована стаття українською мовою

---

## Детальний опис нод

### 1. When Chat Message Received (Chat Trigger)

**Призначення:** Приймає запити користувача через веб-інтерфейс

**Параметри:**
- **Allow File Uploads**: `true` (можна завантажувати файли)
- **Webhook ID**: Унікальний ID для чату

**Вхід:** Повідомлення користувача з темою

**Вихід:**
```json
{
  "chatInput": "Тема для статті",
  "sessionId": "unique-session-id"
}
```

---

### 2. AI Orkestrator (Головний агент-координатор)

**Призначення:** Класифікує теми та координує роботу інших агентів

**Модель:** GPT-5-mini (OpenAI Chat Model)

#### Повний System Prompt:

```
#### РОЛЬ
Ти кваліфікований менеджер з 15 річним досвідом який вміє керувати командами з більше 10 людей. Ти вмієш:
1. Класифікувати запит від користувача
2. Правильно ставити задачі для агентських систем

#### КОНТЕКСТ
Користувач надаватиме тобі теми дописів на основі яких ти маєш виконати Запит. ЗАВЖДИ використовуй інструменти згідно класифікованого запиту

#### ЗАПИТ
Виконай наступні дії:
1. Класифікуй запит користувача згідно двух тем: Запит пов'язаний з штучним інтелектом або Запит немає відношення до Штучного інтелекту. тільки одним словом «ШІ» або «неШІ»
2. Якщо класифікував запит користувача як «ШІ», то виконай інструкції які знаходяться між тегами <AI> і не виконуй інструкції які знаходяться між тегами <noAI>
3. Якщо класифікував запит користувача як «неШІ», то виконай інструкції які знаходяться між тегами <noAI> і не виконуй інструкції які знаходяться між тегами <AI>. Передай отриману відповідь від інструменту «Other_topic» на інструмент «AI_topic»
4. Напиши допис в структурованову вигляді згідно відповіді, яку ти отримав від інструменту «AI_topic» на тему використання ШІ і формату відповіді, який знаходиться в розділі «ФОРМАТ ВІДПОВІДІ»

#### ОБМЕЖЕННЯ
Завжди очікуй відповідь користувача. Якщо користувач не надав тобі тему, то запитай його.
Якщо користувач надав тобі тему, яка для тебе не є зрозумілою (просто набір цифр, набір букв, одне слово або схожі за цією логікою запити), то попроси користувача деталізувати
Відповідь надай Українською мовою
Якщо ти не запустив і не отримав відповідь від інструменту "AI_topic" то обовязково запусти його і виконай ЗАПИТ

#### ФОРМАТ ВІДПОВІДІ
Відповідь надай згідно структури нижче
Тема: [тут тема статті]
Текст: [тут текст статті]

#### ДОДАТКОВА ІНФОРМАЦІЯ
<AI>
Виконай наступні дії:
1. Деталізовано напиши тему і опис допису згідно Запиту користувача
2. Передай цю тему та опис на інструмент «AI_topic»
3. Отримай відповідь від інструменту і продовжуй виконувати дії згідно розділу ЗАПИТ
</AI>

<noAI>
Виконай наступні дії:
1. Деталізовано напиши тему і опис допису згідно Запиту користувача
2. Передай цю тему та опис на інструмент «Other_topic»
3. Отримай відповідь від інструменту «Генерація інших тем»
4. Передай отриману відповідь від інструменту «Other_topic» на інструмент «AI_topic»
5. Отримай відповідь від інструменту і продовжуй виконувати дії згідно розділу ЗАПИТ
</noAI>
```

#### Що робить AI Orkestrator:

1. **Класифікація:**
   - Визначає чи тема пов'язана зі штучним інтелектом
   - Присвоює мітку "ШІ" або "неШІ"

2. **Маршрутизація:**
   - **Якщо "ШІ"**: викликає тільки AI_topic
   - **Якщо "неШІ"**: викликає Other_topic → потім AI_topic

3. **Валідація:**
   - Перевіряє чи тема зрозуміла
   - Запитує деталізацію якщо потрібно

4. **Формування результату:**
   - Збирає відповідь від агентів
   - Форматує фінальну статтю

**Підключені інструменти:**
- Other_topic (Agent Tool)
- AI_topic (Agent Tool)

---

### 3. Other_topic (Агент для неШІ тем)

**Призначення:** Генерує кейси впровадження ШІ для тем не пов'язаних з AI

**Модель:** GPT-5-mini (OpenAI Chat Model1)

**Tool Description:**
```
Запускай цей інструмент тільки у випадку якщо користувачаю запит класифікується як "неШІ"
```

#### System Prompt:

```
#### РОЛЬ
Ти професійний ШІ інженер в сфері впровадження ШІ в бізнес. Ти вмієш на основі запиту користувача надавати рекомендації по впровадженню ШІ

#### КОНТЕКСТ
На основі даних від користувача виконай ЗАПИТ

#### ЗАПИТ
Виконай наступні дії:
• Проаналізуй запит Користувача на предмет використання ШІ в тій темі яку він задав
• Напиши 3 можливих кейсів застосування ШІ в темі що тобі надав користувач
• Відповідь надай в форматі назви і опису кейсу застосування

#### ОБМЕЖЕННЯ
Відповідай українською мовою
Використовуй тільки кейси які пов'язані з темою запиту Користувача

#### ФОРМАТ ВІДПОВІДІ
Відповідь надай в форматі JSON згідно структури яка знаходиться між тегами <STRUCT>
<STRUCT>
{
  "usecase_name_1": "Назва кейсу першого",
  "usecase_description_1": "Опис застосування цього кейсу",
  "usecase_name_2": "Назва кейсу другого",
  "usecase_description_2": "Опис застосування цього кейсу",
  "usecase_name_3": "Назва кейсу третього",
  "usecase_description_3": "Опис застосування цього кейсу"
}
</STRUCT>
```

#### Що робить Other_topic:

1. **Аналіз теми:**
   - Отримує тему не пов'язану зі штучним інтелектом
   - Наприклад: "Здорове харчування", "Маркетинг в Instagram"

2. **Генерація кейсів:**
   - Придумує 3 способи використання ШІ в цій темі
   - Кожен кейс має назву та опис

3. **Приклад виходу:**

**Тема:** "Ресторанний бізнес"

```json
{
  "usecase_name_1": "Персоналізоване меню",
  "usecase_description_1": "ШІ аналізує вподобання клієнтів та рекомендує страви на основі історії замовлень",
  "usecase_name_2": "Прогнозування попиту",
  "usecase_description_2": "Прогнозування кількості відвідувачів та оптимізація закупівель продуктів",
  "usecase_name_3": "Чат-бот для резервацій",
  "usecase_description_3": "Автоматичне бронювання столиків через Telegram або веб-сайт"
}
```

**Вихід передається в:** AI_topic для створення фінальної статті

**Structured Output Parser:** Так (Parser 1)
- Гарантує JSON формат виходу
- Валідує структуру з 3 кейсами

---

### 4. AI_topic (Агент для ШІ тем)

**Призначення:** Створює детальні статті про штучний інтелект

**Модель:** GPT-5-mini (OpenAI Chat Model2)

**Tool Description:**
```
Запускай цей інструмент тільки у випадку якщо користувач запит класифікується як "ШІ"
```

#### System Prompt:

```
#### РОЛЬ
Ти контент-агент, який аналізує теми та надає структуровані відповіді українською мовою.

#### КОНТЕКСТ
Ти маєш тему про штучний інтелект.

#### ЗАПИТ
Виконай наступні кроки:
• Проаналізуй тему користувача на предмет детальної інформації про використання ШІ
• На основі теми користувача в стилі блогера напиши статтю на 500 слів, яка буде цікавити в інші люди і підштовхне їхнього інтересу. Статтю починай з заголовку, робиш кілька абзаців структурованих згідно, робиш описання конкретних кейсів, робиш висновок, даєш поради щодо використання.

#### ОБМЕЖЕННЯ
Відповідь надай згідно структури нижче

#### ФОРМАТ ВІДПОВІДІ
Відповідь надай в форматі JSON згідно структури між тегами <STRUCT>
<STRUCT>
{
  "topic": "Назва теми статті",
  "text": "Повний текст статті"
}
</STRUCT>
```

#### Що робить AI_topic:

1. **Приймає вхід:**
   - **Варіант 1 (ШІ тема)**: Тема безпосередньо від користувача
   - **Варіант 2 (неШІ тема)**: 3 кейси від Other_topic

2. **Створює статтю:**
   - Обсяг: ~500 слів
   - Стиль: блогерський, цікавий
   - Структура:
     - Заголовок
     - Вступ
     - Кілька абзаців з описом
     - Конкретні кейси використання
     - Висновок
     - Поради щодо впровадження

3. **Приклад статті:**

**Вхід:** "ChatGPT для маркетингу"

**Вихід:**
```json
{
  "topic": "Як ChatGPT революціонізує маркетинг: практичні кейси",
  "text": "# Як ChatGPT революціонізує маркетинг\n\nШтучний інтелект змінює правила гри в маркетингу...\n\n## Автоматизація контенту\nChatGPT може генерувати...\n\n## Кейс 1: Email маркетинг\n...\n\n## Висновок\n...\n\n## Поради\n1. Починайте з простих завдань\n2. Завжди редагуйте вихід AI..."
}
```

**Structured Output Parser:** Так (Parser 2)
- Гарантує JSON з полями topic та text
- Валідує наявність обох полів

---

### 5-7. OpenAI Chat Model (x3)

**Призначення:** Мовні моделі для кожного агента

**Параметри:**
- **Model:** gpt-5-mini
- **Credentials:** OpenAI API ключ

**Розподіл:**
- **OpenAI Chat Model** → AI Orkestrator
- **OpenAI Chat Model1** → Other_topic
- **OpenAI Chat Model2** → AI_topic

---

## Детальний опис промптів

### Структура промптів

Всі промпти в системі побудовані за єдиною структурою:

#### 1. РОЛЬ
Визначає хто є агент та які у нього навички

**Приклади:**
- AI Orkestrator: "Кваліфікований менеджер з 15 річним досвідом"
- Other_topic: "Професійний ШІ інженер в сфері впровадження ШІ в бізнес"
- AI_topic: "Контент-агент, який аналізує теми"

#### 2. КОНТЕКСТ
Описує ситуацію та вхідні дані

**Приклади:**
- "Користувач надаватиме тобі теми дописів"
- "На основі даних від користувача виконай ЗАПИТ"
- "Ти маєш тему про штучний інтелект"

#### 3. ЗАПИТ
Конкретні інструкції що треба зробити

**Формат:**
```
Виконай наступні дії:
1. [Крок 1]
2. [Крок 2]
3. [Крок 3]
...
```

#### 4. ФОРМАТ ВІДПОВІДІ
Структура виходу (JSON, текст, таблиця)

**Використовується:**
```
<STRUCT>
{json схема}
</STRUCT>
```

#### 5. ОБМЕЖЕННЯ
Правила та заборони

**Приклади:**
- "Відповідай українською мовою"
- "Завжди очікуй відповідь користувача"
- "Використовуй тільки кейси пов'язані з темою"

#### 6. ДОДАТКОВА ІНФОРМАЦІЯ (опціонально)
Інструкції для різних сценаріїв

**Використовується:**
- `<AI>` - інструкції для ШІ тем
- `<noAI>` - інструкції для неШІ тем

---

## Приклади використання

### Приклад 1: ШІ-тема

**Запит користувача:**
```
Напиши статтю про використання ChatGPT для програмістів
```

**Хід виконання:**

1. **AI Orkestrator:**
   - Класифікація: "ШІ" ✓
   - Маршрут: тільки AI_topic

2. **AI_topic:**
   - Створює статтю про ChatGPT для програмістів
   - Обсяг: 500 слів
   - Формат: JSON

**Результат:**
```
Тема: ChatGPT для програмістів: 10 способів підвищити продуктивність

Текст: [Детальна стаття з прикладами використання ChatGPT в розробці...]
```

---

### Приклад 2: неШІ-тема

**Запит користувача:**
```
Напиши статтю про відкриття кав'ярні
```

**Хід виконання:**

1. **AI Orkestrator:**
   - Класифікація: "неШІ" ✓
   - Маршрут: Other_topic → AI_topic

2. **Other_topic:**
   - Генерує 3 кейси впровадження ШІ:
     1. Автоматизація замовлень через бота
     2. Прогнозування попиту на каву
     3. Персоналізовані рекомендації для клієнтів

3. **AI_topic:**
   - Отримує кейси від Other_topic
   - Створює статтю про використання ШІ в кав'ярні

**Результат:**
```
Тема: Як ШІ допоможе відкрити сучасну кав'ярню

Текст: [Стаття про 3 кейси використання штучного інтелекту в кав'ярні...]
```

---

### Приклад 3: Незрозуміла тема

**Запит користувача:**
```
123 abc
```

**Хід виконання:**

1. **AI Orkestrator:**
   - Виявляє незрозумілий запит
   - Відповідь: "Будь ласка, деталізуйте вашу тему. Наприклад, про що ви хочете отримати статтю?"

**Результат:**
```
Відповідь надай Українською мовою:
Будь ласка, деталізуйте вашу тему. Ваш запит "123 abc" не є зрозумілим.
Надайте тему для статті, наприклад:
- "ChatGPT для маркетингу"
- "Здорове харчування"
- "Створення стартапу"
```

---

## Налаштування workflow

### Крок 1: Імпорт

1. Завантажте `LESSON-6-2.json`
2. n8n → Workflows → Import from File
3. Оберіть файл

### Крок 2: OpenAI API ключ

**Для всіх трьох моделей:**

1. Клікніть на **OpenAI Chat Model**
2. Create New Credential → OpenAI
3. Вставте API ключ
4. Збережіть

Повторіть для:
- OpenAI Chat Model1
- OpenAI Chat Model2

### Крок 3: Налаштування Structured Output Parsers

**Parser 1 (для Other_topic):**

JSON Schema:
```json
{
  "usecase_name_1": "Назва кейсу першого",
  "usecase_description_1": "Опис застосування цього кейсу",
  "usecase_name_2": "Назва кейсу другого",
  "usecase_description_2": "Опис застосування цього кейсу",
  "usecase_name_3": "Назва кейсу третього",
  "usecase_description_3": "Опис застосування цього кейсу"
}
```

**Parser 2 (для AI_topic):**

JSON Schema:
```json
{
  "topic": "Назва теми статті",
  "text": "Повний текст статті"
}
```

### Крок 4: Перевірка промптів

**AI Orkestrator:**
- Перевірте що System Message містить секції `<AI>` та `<noAI>`
- Переконайтесь що інструменти підключені

**Other_topic:**
- Tool Description: "неШІ"
- System Message містить РОЛЬ, КОНТЕКСТ, ЗАПИТ
- Structured Output Parser підключений

**AI_topic:**
- Tool Description: "ШІ"
- System Message містить інструкції для створення статей
- Structured Output Parser підключений

### Крок 5: Активація

1. Натисніть **Activate**
2. Скопіюйте Production URL з Chat Trigger
3. Відкрийте URL в браузері

---

## Тестування системи

### Тест 1: ШІ-тема

**Запит:**
```
Напиши про використання Claude AI для аналізу даних
```

**Очікуваний результат:**
- AI Orkestrator класифікує як "ШІ"
- AI_topic створює статтю
- Формат: Тема + Текст (500 слів)

**Перевірка:**
1. Відкрийте Execution History
2. Подивіться на AI Orkestrator → повинен викликати тільки AI_topic
3. Перевірте вихід AI_topic → JSON з topic та text

---

### Тест 2: неШІ-тема

**Запит:**
```
Напиши статтю про фітнес для початківців
```

**Очікуваний результат:**
- AI Orkestrator класифікує як "неШІ"
- Other_topic генерує 3 кейси ШІ для фітнесу
- AI_topic створює статтю на основі цих кейсів
- Формат: Тема + Текст про використання ШІ у фітнесі

**Перевірка:**
1. AI Orkestrator → викликає Other_topic
2. Other_topic → повертає JSON з 3 кейсами
3. AI Orkestrator → передає в AI_topic
4. AI_topic → створює фінальну статтю

---

### Тест 3: Незрозумілий запит

**Запит:**
```
abc
```

**Очікуваний результат:**
- AI Orkestrator просить деталізувати
- Не викликає інструменти

---

## Модифікація промптів

### Зміна стилю статей

**В AI_topic → System Message:**

**Замість:**
```
в стилі блогера напиши статтю на 500 слів
```

**Варіанти:**

**Науковий стиль:**
```
в науковому стилі напиши статтю на 1000 слів з посиланнями на дослідження
```

**SEO-орієнтований:**
```
в SEO-стилі напиши статтю на 800 слів з ключовими словами та підзаголовками H2, H3
```

**Для соціальних мереж:**
```
в casual стилі напиши пост на 300 слів з емодзі та хештегами
```

---

### Зміна кількості кейсів

**В Other_topic → System Message:**

**Замість:**
```
Напиши 3 можливих кейсів
```

**Варіанти:**
```
Напиши 5 можливих кейсів  # більше варіантів
Напиши 1 найкращий кейс   # фокус на якість
```

**Також змініть JSON Schema:**
```json
{
  "usecase_name_1": "...",
  "usecase_description_1": "...",
  "usecase_name_2": "...",
  "usecase_description_2": "...",
  ...
  "usecase_name_5": "...",
  "usecase_description_5": "..."
}
```

---

### Додати категорії класифікації

**В AI Orkestrator → System Message:**

**Замість 2 категорій (ШІ/неШІ), додайте більше:**

```
Класифікуй запит користувача згідно трьох тем:
1. "ШІ" - штучний інтелект
2. "Бізнес" - підприємництво
3. "Особистий розвиток"
```

Додайте нові секції:
```
<AI>...</AI>
<Business>...</Business>
<Personal>...</Personal>
```

Створіть нові Agent Tools для кожної категорії.

---

## Розширення функціональності

### Додати пам'ять діалогу

1. Додайте **Window Buffer Memory** ноду
2. Підключіть до AI Orkestrator
3. Налаштуйте Context Window: 10 повідомлень

**Що це дає:**
- Агент пам'ятає попередні запити
- Можна продовжувати розмову
- "Додай ще один кейс до попередньої статті"

---

### Додати векторну базу знань

1. Додайте **Vector Store** (Pinecone або In-Memory)
2. Завантажте статті про ШІ
3. Підключіть як Tool до AI_topic

**Що це дає:**
- Статті базуються на реальних даних
- Точніша інформація
- Посилання на джерела

---

### Додати експорт в Google Docs

1. Після AI_topic додайте **Google Docs** ноду
2. Параметри:
   - Document Name: `{{ $json.topic }}`
   - Content: `{{ $json.text }}`

**Що це дає:**
- Автоматичне збереження статей
- Можливість редагувати в Google Docs
- Історія всіх згенерованих статей

---

### Додати Telegram бота

1. Замініть Chat Trigger на **Telegram Trigger**
2. Результат відправте через **Telegram** ноду

**Що це дає:**
- Генерація статей прямо з Telegram
- Зручніше для мобільного використання
- Можна ділитися з командою

---

## Типові проблеми

### Проблема: "AI Orkestrator не викликає інструменти"

**Причина:** Інструменти не підключені або Tool Description неправильний

**Рішення:**
1. Перевірте що Other_topic та AI_topic підключені до AI Orkestrator
2. Перевірте Tool Description в кожному агенті
3. Перезапустіть workflow

---

### Проблема: "JSON parse error"

**Причина:** Structured Output Parser не налаштований

**Рішення:**
1. Перевірте що Parser підключений до агента
2. Перевірте JSON Schema - має бути валідний JSON
3. Переконайтесь що в System Message є секція `<STRUCT>`

---

### Проблема: "Агент генерує англійською мовою"

**Причина:** В промпті не вказано мову

**Рішення:**
Додайте в **ОБМЕЖЕННЯ**:
```
Відповідай ТІЛЬКИ українською мовою
```

Або замініть на свою мову.

---

### Проблема: "Other_topic не передає дані в AI_topic"

**Причина:** AI Orkestrator не викликає обидва інструменти послідовно

**Рішення:**
Перевірте секцію `<noAI>` в AI Orkestrator:
```
4. Передай отриману відповідь від інструменту «Other_topic» на інструмент «AI_topic»
```

Ця інструкція має бути присутня.

---

## Use Cases (Приклади застосування)

### 1. Контент-маркетинг агентство

**Сценарій:**
- Клієнти надають теми
- Система генерує статті
- Автоматичне додавання в контент-календар

**Налаштування:**
- Підключити Google Sheets для зберігання
- Додати SEO-оптимізацію в промпт AI_topic
- Встановити обсяг 1000-1500 слів

---

### 2. Навчальна платформа

**Сценарій:**
- Студенти запитують теми
- Система генерує навчальні матеріали
- Додає приклади використання ШІ

**Налаштування:**
- Змінити стиль на освітній
- Додати секцію з завданнями
- Підключити базу знань з підручниками

---

### 3. Корпоративний блог про ШІ

**Сценарій:**
- Працівники пропонують теми
- Система створює статті про впровадження ШІ
- Публікація в Medium або LinkedIn

**Налаштування:**
- Додати експорт в Notion
- Включити посилання на case studies
- Додати секцію ROI (Return on Investment)

---

### 4. Telegram канал про технології

**Сценарій:**
- Адмін пише тему в бота
- Отримує готовий пост
- Публікує в канал

**Налаштування:**
- Замінити Chat на Telegram Trigger
- Зменшити обсяг до 300-400 слів
- Додати емодзі та хештеги

---

## Автор

**Розробник:** Сергій Щербаков

**Email:** sergiyscherbakov@ukr.net

**Telegram:** @s_help_2010

---

## Ліцензія

Цей проект доступний для вільного використання та модифікації.

## Підтримка

Якщо виникли питання:
1. Перевірте налаштування промптів в кожному агенті
2. Подивіться Execution History для debug
3. Перегляньте документацію n8n: https://docs.n8n.io/
4. Документація LangChain: https://js.langchain.com/docs/
